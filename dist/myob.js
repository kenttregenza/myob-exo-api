/*
Copyright (c) 2015-2019 BIZEX (NZ) LTD - All Rights Reserved
The library can not be copied and/or distributed without the express permission of BIZEX (NZ) LTD https://www.bizex.co.nz
Please contact us if you want to use the library on your projects
@author ukalpa@gmail.com
 */
module.exports=function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=28)}([function(t,e){t.exports=require("lodash")},function(t,e,i){"use strict";function r(t){return function(t){return t}(t)}const s={eq:r("eq"),ne:r("ne"),ge:r("ge"),gte:r("ge"),gt:r("gt"),le:r("le"),lte:r("le"),lt:r("lt"),not:r("not"),is:r("is"),in:r("in"),notIn:r("notIn"),like:r("like"),notLike:r("notLike"),iLike:r("iLike"),notILike:r("notILike"),startsWith:r("startsWith"),endsWith:r("endsWith"),substring:r("substring"),regexp:r("regexp"),notRegexp:r("notRegexp"),iRegexp:r("iRegexp"),notIRegexp:r("notIRegexp"),between:r("between"),notBetween:r("notBetween"),overlap:r("overlap"),contains:r("contains"),contained:r("contained"),adjacent:r("adjacent"),strictLeft:r("strictLeft"),strictRight:r("strictRight"),noExtendRight:r("noExtendRight"),noExtendLeft:r("noExtendLeft"),and:r("and"),or:r("or"),any:r("any"),all:r("all"),values:r("values"),col:r("col"),placeholder:r("placeholder"),join:r("join"),expand:r("expand"),select:r("select"),top:r("top"),orderby:r("orderby"),filter:r("filter")};t.exports=s},function(t,e,i){"use strict";t.exports={SELECT:"SELECT",INSERT:"INSERT",UPDATE:"UPDATE",BULKUPDATE:"BULKUPDATE",BULKDELETE:"BULKDELETE",DELETE:"DELETE",UPSERT:"UPSERT",VERSION:"VERSION",SHOWTABLES:"SHOWTABLES",SHOWINDEXES:"SHOWINDEXES",DESCRIBE:"DESCRIBE",RAW:"RAW",FOREIGNKEYS:"FOREIGNKEYS",SHOWCONSTRAINTS:"SHOWCONSTRAINTS"}},function(t,e,i){"use strict";const r=i(16).getNewLibraryCopy();t.exports=r,t.exports.Promise=r,t.exports.default=r},function(t,e,i){"use strict";e.BaseError=i(9),e.EagerLoadingError=i(17),e.ValidationError=i(18),e.ValidationErrorItem=e.ValidationError.ValidationErrorItem,e.EmptyResultError=i(19)},function(t,e){t.exports=require("util")},function(t,e){t.exports=require("url")},function(t,e,i){"use strict";const r=i(0),{logger:s}=i(11),n=i(3),a=s.debugContext("hooks"),o={beforeValidate:{params:2},afterValidate:{params:2},validationFailed:{params:3},beforeCreate:{params:2},afterCreate:{params:2},beforeDestroy:{params:2},afterDestroy:{params:2},beforeRestore:{params:2},afterRestore:{params:2},beforeUpdate:{params:2},afterUpdate:{params:2},beforeSave:{params:2,proxies:["beforeUpdate","beforeCreate"]},afterSave:{params:2,proxies:["afterUpdate","afterCreate"]},beforeUpsert:{params:2},afterUpsert:{params:2},beforeBulkCreate:{params:2},afterBulkCreate:{params:2},beforeBulkDestroy:{params:1},afterBulkDestroy:{params:1},beforeBulkRestore:{params:1},afterBulkRestore:{params:1},beforeBulkUpdate:{params:1},afterBulkUpdate:{params:1},beforeFind:{params:1},beforeFindAfterExpandIncludeAll:{params:1},beforeFindAfterOptions:{params:1},afterFind:{params:2},beforeCount:{params:1},beforeDefine:{params:2,sync:!0,noEntity:!0},afterDefine:{params:1,sync:!0,noEntity:!0},beforeInit:{params:2,sync:!0,noEntity:!0},afterInit:{params:1,sync:!0,noEntity:!0},beforeAssociate:{params:2,sync:!0},afterAssociate:{params:2,sync:!0},beforeConnect:{params:1,noEntity:!0},afterConnect:{params:2,noEntity:!0},beforeSync:{params:1},afterSync:{params:1},beforeBulkSync:{params:1},afterBulkSync:{params:1},beforeQuery:{params:2},afterQuery:{params:2}};e.hooks=o;const u=t=>o[t].proxies?o[t].proxies.concat(t):[t];function c(t,e){return(t.options.hooks||{})[e]||[]}const l={_setupHooks(t){this.options.hooks={},r.map(t||{},(t,e)=>{Array.isArray(t)||(t=[t]),t.forEach(t=>this.addHook(e,t))})},runHooks(t,...e){if(!t)throw new Error("runHooks requires at least 1 argument");let i;if("string"==typeof t&&(t=c(this,i=t),this.exo&&(t=t.concat(c(this.exo,i)))),Array.isArray(t)||(t=[t]),!o[i]||!o[i].sync)return n.each(t,t=>("object"==typeof t&&(t=t.fn),a(`running hook ${i}`),t.apply(this,e))).return();for(let r of t)"object"==typeof r&&(r=r.fn),a(`running hook(sync) ${i}`),r.apply(this,e)},addHook(t,e,i){return"function"==typeof e&&(i=e,e=null),a(`adding hook ${t}`),(t=u(t)).forEach(t=>{const r=c(this,t);r.push(e?{name:e,fn:i}:i),this.options.hooks[t]=r}),this},removeHook(t,e){const i="function"==typeof e;if(!this.hasHook(t))return this;a(`removing hook ${t}`),t=u(t);for(const r of t)this.options.hooks[r]=this.options.hooks[r].filter(t=>i&&"function"==typeof t?t!==e:!(!i&&"object"==typeof t)||t.name!==e);return this},hasHook(t){return this.options.hooks[t]&&!!this.options.hooks[t].length}};l.hasHooks=l.hasHook,e.applyTo=function(t,e=!1){r.mixin(t,l);for(const i of Object.keys(o))e&&o[i].noEntity||(t[i]=function(t,e){return this.addHook(i,t,e)})}},function(t,e){t.exports=require("node-fetch")},function(t,e,i){"use strict";t.exports=class extends Error{constructor(t){super(t),this.name="ExoBaseError",Error.captureStackTrace(this,this.constructor)}}},function(t,e){t.exports=require("dottie")},function(t,e,i){"use strict";console.log;const r=i(5);class s{constructor(t){this.config=Object.assign({context:"exo",debug:!0},t)}warn(t){console.warn(`(${this.config.context}) Warning: ${t}`)}inspect(t){return r.inspect(t,!1,3)}debugContext(t){}}e.logger=new s,e.Logger=s},function(t,e,i){"use strict";const r=i(0),s=r.cloneDeep(i(21)),n=i(13),a={extend(t,e){return this[t]=e,this},notEmpty:t=>!t.match(/^[\s\t\r\n]*$/),len(t,e,i){return this.isLength(t,e,i)},isUrl(t){return this.isURL(t)},isIPv6(t){return this.isIP(t,6)},isIPv4(t){return this.isIP(t,4)},notIn(t,e){return!this.isIn(t,e)},regex:(t,e,i)=>(t+="","RegExp"!==Object.prototype.toString.call(e).slice(8,-1)&&(e=new RegExp(e,i)),t.match(e)),notRegex(t,e,i){return!this.regex(t,e,i)},isDecimal:t=>""!==t&&!!t.match(/^(?:-?(?:[0-9]+))?(?:\.[0-9]*)?(?:[eE][+-]?(?:[0-9]+))?$/),min(t,e){const i=parseFloat(t);return isNaN(i)||i>=e},max(t,e){const i=parseFloat(t);return isNaN(i)||i<=e},not(t,e,i){return this.notRegex(t,e,i)},contains:(t,e)=>!!e&&t.includes(e),notContains(t,e){return!this.contains(t,e)},is(t,e,i){return this.regex(t,e,i)}};e.extensions=a,s.isImmutable=function(t,e,i,r){return r.isNewRecord||r.dataValues[i]===r._previousDataValues[i]},s.notNull=function(t){return null!=t},r.forEach(a,(t,e)=>{s[e]=t}),s.isNull=s.isEmpty,s.isDate=function(t){const e=Date.parse(t);if(isNaN(e))return!1;const i=new Date(e);return n(i.toISOString()).isValid()},e.validator=s},function(t,e){t.exports=require("moment")},function(t,e,i){"use strict";const{deprecate:r}=i(5),s=()=>{};e.noRawAttributes=r(s,"Use accredo.fn / accredo.literal to construct attributes","ACCREDO0001"),e.noTrueLogging=r(s,"The logging-option should be either a function or false. Default: console.log","ACCREDO0002"),e.noStringOperators=r(s,"String based operators are deprecated. Please use Symbol based operators for better security, read more at http://docs.ACCREDOjs.com/manual/querying.html#operators","ACCREDO0003"),e.noBoolOperatorAliases=r(s,"A boolean value was passed to options.operatorsAliases. This is a no-op with v5 and should be removed.","ACCREDO0004"),e.noDoubleNestedGroup=r(s,"Passing a double nested nested array to `group` is unsupported and will be removed in v6.","ACCREDO0005")},function(t,e,i){"use strict";const r=i(25),s=i(0);class n{constructor(t){this.entities=[],this.exo=t}addEntity(t){return this.entities.push(t),this.exo.entities[t.name]=t,t}removeEntity(t){this.entities=this.entities.filter(e=>e.name!==t.name),delete this.exo.entities[t.name]}getEntity(t,e){return e=s.defaults(e||{},{attribute:"name"}),this.entities.find(i=>i[e.attribute]===t)}get all(){return this.entities}forEachEntity(t,e){const i={},n=new r;let a,o;e=s.defaults(e||{},{reverse:!0});for(const t of this.entities){let e=[],r=t.getTableName();s.isObject(r)&&(r=`${r.schema}.${r.tableName}`),i[r]=t;for(const i in t.rawAttributes)if(t.rawAttributes.hasOwnProperty(i)){const r=t.rawAttributes[i];r.references&&(o=r.references.entity,s.isObject(o)&&(o=`${o.schema}.${o.tableName}`),e.push(o))}e=e.filter(t=>r!==t),n.add(r,e)}a=n.sort(),e.reverse&&(a=a.reverse());for(const e of a)t(i[e],e)}}t.exports=n,t.exports.EntityManager=n,t.exports.default=n},function(t,e){t.exports=require("bluebird")},function(t,e,i){"use strict";const r=i(9);t.exports=class extends r{constructor(t){super(t),this.name="ExoEagerLoadingError",Error.captureStackTrace(this,this.constructor)}}},function(t,e,i){"use strict";const r=i(9);class s{constructor(t,e,i,r,n,a,o,u){if(this.message=t||"",this.type=null,this.path=i||null,this.value=void 0!==r?r:null,this.origin=null,this.instance=n||null,this.validatorKey=a||null,this.validatorName=o||null,this.validatorArgs=u||[],e)if(s.Origins[e])this.origin=e;else{const t=`${e}`.toLowerCase().trim(),i=s.TypeStringMap[t];i&&s.Origins[i]&&(this.origin=i,this.type=e)}}getValidatorKey(t,e){const i=void 0===t||!!t,r=void 0===e?".":e,n=this.origin,a=this.validatorKey||this.validatorName,o=i&&n&&s.Origins[n];if(o&&("string"!=typeof r||!r.length))throw new Error("Invalid namespace separator given, must be a non-empty string");return"string"==typeof a&&a.length?(o?[n,a].join(r):a).toLowerCase().trim():""}}s.Origins={CORE:"CORE",DB:"DB",FUNCTION:"FUNCTION"},s.TypeStringMap={"notnull violation":"CORE","string violation":"CORE","unique violation":"DB","validation error":"FUNCTION"},t.exports=class extends r{constructor(t,e){super(t),this.name="ExoValidationError",this.message="Validation Error",this.errors=e||[],t?this.message=t:this.errors.length>0&&this.errors[0].message&&(this.message=this.errors.map(t=>`${t.type||t.origin}: ${t.message}`).join(",\n")),Error.captureStackTrace(this,this.constructor)}get(t){return this.errors.reduce((e,i)=>(i.path===t&&e.push(i),e),[])}},t.exports.ValidationErrorItem=s},function(t,e,i){"use strict";const r=i(9);t.exports=class extends r{constructor(t){super(t),this.name="ExoEmptyResultError",Error.captureStackTrace(this,this.constructor)}}},function(t,e){t.exports=require("wkx")},function(t,e){t.exports=require("validator")},function(t,e){t.exports=require("moment-timezone")},function(t,e){t.exports=require("inflection")},function(t,e,i){"use strict";e.classToInvokable=function(t){return new Proxy(t,{apply:(t,e,i)=>new t(...i),construct:(t,e)=>new t(...e),get:(t,e)=>t[e]})}},function(t,e){t.exports=require("toposort-class")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("fs")},function(t,e,i){"use strict";i.r(e);var r=i(2),s=i.n(r),n=i(0),a=i.n(n),o=i(7),u=i.n(o),c=i(4),l=i.n(c),h=i(5),p=i.n(h);i(20);const d=i(4),y=i(12).validator,f=i(22),g=i(13),{logger:m}=i(11),b={};class w{toString(t){return this.toSql(t)}toSql(){return this.key}stringify(t,e){return this._stringify?this._stringify(t,e):t}bindParam(t,e){return this._bindParam?this._bindParam(t,e):e.bindParam(this.stringify(t,e))}static toString(){return this.name}static warn(t,e){b[e]||(b[e]=!0,m.warn(`${e} \n>> Check: ${t}`))}static extend(t){return new this(t.options)}}class A extends w{constructor(t,e){super();const i="object"==typeof t&&t||{length:t,binary:e};this.options=i,this._binary=i.binary,this._length=i.length||255}toSql(){return`VARCHAR(${this._length})${this._binary?" BINARY":""}`}validate(t){if("[object String]"!==Object.prototype.toString.call(t)){if(this.options.binary&&Buffer.isBuffer(t)||"number"==typeof t)return!0;throw new d.ValidationError(p.a.format("%j is not a valid string",t))}return!0}get BINARY(){return this._binary=!0,this.options.binary=!0,this}static get BINARY(){return(new this).BINARY}}class E extends w{constructor(t={}){super(),"number"==typeof t&&(t={length:t}),this.options=t,this._length=t.length,this._zerofill=t.zerofill,this._decimals=t.decimals,this._precision=t.precision,this._scale=t.scale,this._unsigned=t.unsigned}toSql(){let t=this.key;return this._length&&(t+=`(${this._length}`,"number"==typeof this._decimals&&(t+=`,${this._decimals}`),t+=")"),this._unsigned&&(t+=" UNSIGNED"),this._zerofill&&(t+=" ZEROFILL"),t}validate(t){if(!y.isFloat(A(t)))throw new d.ValidationError(p.a.format(`%j is not a valid ${this.key.toLowerCase()}`,t));return!0}_stringify(t){return"number"==typeof t||"boolean"==typeof t||null==t?t:"function"==typeof t.toString?t.toString():t}get UNSIGNED(){return this._unsigned=!0,this.options.unsigned=!0,this}get ZEROFILL(){return this._zerofill=!0,this.options.zerofill=!0,this}static get UNSIGNED(){return(new this).UNSIGNED}static get ZEROFILL(){return(new this).ZEROFILL}}class v extends E{validate(t){if(!y.isInt(A(t)))throw new d.ValidationError(p.a.format(`%j is not a valid ${this.key.toLowerCase()}`,t));return!0}}class x extends w{toSql(){return"TINYINT(1)"}validate(t){if(!y.isBoolean(A(t)))throw new d.ValidationError(p.a.format("%j is not a valid boolean",t));return!0}_sanitize(t){if(null!=t){Buffer.isBuffer(t)&&1===t.length&&(t=t[0]);const e=typeof t;if("string"===e)return"true"===t||"false"!==t&&t;if("number"===e)return 1===t||0!==t&&t}return t}}x.parse=x.prototype._sanitize;class O extends w{toSql(){return"DATE"}_stringify(t){return g(t).format("YYYY-MM-DD")}_sanitize(t,e){return(!e||e&&!e.raw)&&t?g(t).format("YYYY-MM-DD"):t}_isChanged(t,e){return(!e||!t||e!==t)&&!(!e&&!t&&e===t)}}const I={String:A,Byte:class extends A{},Word:class extends A{},Smallint:class extends v{},Integer:v,Float:class extends E{constructor(t,e){super("object"==typeof t&&t||{length:t,decimals:e})}validate(t){if(!y.isFloat(A(t)))throw new d.ValidationError(p.a.format("%j is not a valid float",t));return!0}},Boolean:x,Date:O,Time:class extends w{toSql(){return"TIME"}},DateTime:class extends w{constructor(t){super();const e="object"==typeof t&&t||{length:t};this.options=e,this._length=e.length||""}toSql(){return"DATETIME"}validate(t){if(!y.isDate(A(t)))throw new d.ValidationError(p.a.format("%j is not a valid date",t));return!0}_sanitize(t,e){return e&&(!e||e.raw)||t instanceof O||!t?t:new O(t)}_isChanged(t,e){return!(e&&t&&(t===e||t instanceof O&&e instanceof O&&t.getTime()===e.getTime()))&&!(!e&&!t&&e===t)}_applyTimezone(t,e){return e.timezone?f.tz.zone(e.timezone)?f(t).tz(e.timezone):g(t).utcOffset(e.timezone):f(t)}_stringify(t,e){return(t=this._applyTimezone(t,e)).format("YYYY-MM-DD HH:mm:ss.SSS Z")}},AutoInc:class extends w{},Largeint:class extends v{},Variant:class extends w{},RowID:class extends v{},Arr:class extends w{},Obj:class extends w{}};a.a.each(I,(t,e)=>{t.hasOwnProperty("key")||(t.types={},t.key=t.prototype.key=e)});var S=I;const k=i(1),j=new Set(a.a.values(k)),D={};D.dd=void 0!==console.log?console.log:function(){};D.debug=function(){process.env&&process.env.DEBUG&&console.log("* DEBUG * ",...arguments)};let N=i(23);D.classToInvokable=i(24).classToInvokable,D.useInflection=function(t){N=t},D.camelizeIf=function(t,e){let i=t;return e&&(i=$(t)),i},D.underscoredIf=function(t,e){let i=t;return e&&(i=B(t)),i},D.isPrimitive=function(t){const e=typeof t;return"string"===e||"number"===e||"boolean"===e};class T{}D.ExoMethod=T;class V extends T{constructor(t,e){super(),this.fn=t,this.args=e}clone(){return new V(this.fn,this.args)}}D.Fn=V;D.Col=class extends T{constructor(t,...e){super(),e.length>0&&(t=e),this.col=t}};D.Cast=class extends T{constructor(t,e,i){super(),this.val=t,this.type=(e||"").trim(),this.json=i||!1}};D.Literal=class extends T{constructor(t){super(),this.val=t}};D.Json=class extends T{constructor(t,e){super(),a.a.isObject(t)?this.conditions=t:(this.path=t,e&&(this.value=e))}};function P(t){return Object.getOwnPropertySymbols(t).filter(t=>j.has(t))}function R(t){return P(t).concat(Object.keys(t))}function $(t){return t.trim().replace(/[-_\s]+(.)?/g,(t,e)=>e.toUpperCase())}function B(t){return N.underscore(t)}function C(t,e){return Array.isArray(t.attributes)&&(t.attributes=t.attributes.map(t=>"string"!=typeof t?t:e.rawAttributes[t]&&t!==e.rawAttributes[t].field?[e.rawAttributes[t].field,t]:t)),t.where&&a.a.isPlainObject(t.where)&&(t.where=q(t.where,e)),t}function q(t,e){return t&&R(t).forEach(i=>{const r=e.rawAttributes[i];r&&r.field!==r.fieldName&&(t[r.field]=t[i],delete t[i]),a.a.isPlainObject(t[i])&&(t[i]=C({where:t[i]},e).where),Array.isArray(t[i])&&t[i].forEach((r,s)=>{a.a.isPlainObject(r)&&(t[i][s]=q(r,e))})}),t}D.Where=class extends T{constructor(t,e,i){super(),void 0===i&&(i=e,e="="),this.attribute=t,this.comparator=e,this.logic=i}},D.getOperators=P,D.getComplexKeys=R,D.merge=function t(){const e={};for(const i of arguments)a.a.forOwn(i,(i,r)=>{void 0!==i&&(e[r]?a.a.isPlainObject(i)&&a.a.isPlainObject(e[r])?e[r]=t(e[r],i):Array.isArray(i)&&Array.isArray(e[r])?e[r]=i.concat(e[r]):e[r]=i:e[r]=i)});return e},D.spliceStr=function(t,e,i,r){return t.slice(0,e)+r+t.slice(e+i)},D.camelize=$,D.underscore=B,D.nameIndex=function(t,e){if(e.tableName&&(e=e.tableName),!t.hasOwnProperty("name")){const i=t.fields.map(t=>"string"==typeof t?t:t.name||t.attribute);t.name=B(`${e}_${i.join("_")}`)}return t},D.cloneDeep=function(t){return t=t||{},a.a.cloneDeepWith(t,t=>{if(!Array.isArray(t)&&!a.a.isPlainObject(t))return"object"==typeof t?t:t&&"function"==typeof t.clone?t.clone():void 0})},D.mapFinderOptions=function(t,e){return t.attributes&&Array.isArray(t.attributes)&&(t.attributes=e._injectDependentVirtualAttributes(t.attributes),t.attributes=t.attributes.filter(t=>!e._virtualAttributes.has(t))),C(t,e),t},D.mapOptionFieldNames=C,D.mapWhereFieldNames=q,D.mapValueFieldNames=function(t,e,i){const r={};for(const s of e)void 0===t[s]||i._virtualAttributes.has(s)||(i.rawAttributes[s]&&i.rawAttributes[s].field&&i.rawAttributes[s].field!==s?r[i.rawAttributes[s].field]=t[s]:r[s]=t[s]);return r},D.now=function(){const t=new Date;return t.setMilliseconds(0),t};var L=D,M=i(3),K=i.n(M),F=i(10),U=i.n(F);const H=i(12).validator;L.dd;class Q{constructor(t,e){e=a.a.clone(e)||{},Array.isArray(e.fields)&&e.fields.length>0&&!e.skip&&(e.skip=a.a.difference(Object.keys(t.constructor.rawAttributes),e.fields)),this.options=a.a.defaults(e,{skip:[],hooks:!0}),this.entityInstance=t,this.validator=H,this.errors=[],this.inProgress=!1}_validate(){if(this.inProgress)throw new Error("Validations already in progress.");return this.inProgress=!0,K.a.all([this._perAttributeValidators().reflect(),this._customValidators().reflect()]).then(()=>{if(this.errors.length)throw new l.a.ValidationError(null,this.errors)})}validate(){return this.options.hooks?this._validateAndRunHooks():this._validate()}_validateAndRunHooks(){const t=this.entityInstance.constructor.runHooks.bind(this.entityInstance.constructor);return t("beforeValidate",this.entityInstance,this.options).then(()=>this._validate().catch(e=>t("validationFailed",this.entityInstance,this.options,e).then(t=>{throw t||e}))).then(()=>t("afterValidate",this.entityInstance,this.options)).return(this.entityInstance)}_perAttributeValidators(){const t=[];return a.a.forIn(this.entityInstance.rawAttributes,(e,i)=>{if(this.options.skip.includes(i))return;const r=this.entityInstance.dataValues[i];r instanceof L.ExoMethod||(e._autoGenerated||e.autoIncrement||this._validateSchema(e,i,r),this.entityInstance.validators.hasOwnProperty(i)&&t.push(this._singleAttrValidate(r,i,e.allowNull).reflect()))}),K.a.all(t)}_customValidators(){const t=[];return a.a.each(this.entityInstance._entityOptions.validate,(e,i)=>{if(this.options.skip.includes(i))return;const r=this._invokeCustomValidator(e,i).catch(()=>{}).reflect();t.push(r)}),K.a.all(t)}_singleAttrValidate(t,e,i){if(null==t&&!i)return K.a.resolve();const r=[];return a.a.forIn(this.entityInstance.validators[e],(i,s)=>{if("isUrl"!==s&&"isURL"!==s&&"isEmail"!==s||("object"==typeof i&&null!==i&&i.msg?i={msg:i.msg}:!0===i&&(i={})),"function"==typeof i)return void r.push(this._invokeCustomValidator(i,s,!0,t,e).reflect());if(null==t)return;const n=this._invokeBuiltinValidator(t,i,s,e);n.catch(()=>{}),r.push(n.reflect())}),K.a.all(r).then(i=>this._handleReflectedResult(e,t,i))}_invokeCustomValidator(t,e,i,r,s){let n=null,a=!1;const o=t.length;let u,c=1,l=e;return i&&(c=2,u=r,l=s),o===c&&(a=!0),a?(n=i?K.a.promisify(t.bind(this.entityInstance,u)):K.a.promisify(t.bind(this.entityInstance)))().catch(t=>this._pushError(!1,l,t,r,e)):K.a.try(()=>t.call(this.entityInstance,u)).catch(t=>this._pushError(!1,l,t,r,e))}_invokeBuiltinValidator(t,e,i,r){return K.a.try(()=>{const s=String(t);if("function"!=typeof H[i])throw new Error(`Invalid validator function: ${i}`);const n=this._extractValidatorArgs(e,i,r);if(!H[i](s,...n))throw Object.assign(new Error(e.msg||`Validation ${i} on ${r} failed`),{validatorName:i,validatorArgs:n})})}_extractValidatorArgs(t,e,i){let r=t.args||t;const s="string"!=typeof r&&("isAlpha"===e||"isAlphanumeric"===e||"isMobilePhone"===e);return r=Array.isArray(r)?r.slice(0):"isImmutable"===e?[r,i,this.entityInstance]:s||"isIP"===e?[]:[r]}_validateSchema(t,e,i){if(!1===t.allowNull&&null==i){const t=this.entityInstance.validators[e],r=a.a.get(t,"notNull.msg",`${this.entityInstance.constructor.name}.${e} cannot be null`);this.errors.push(new l.a.ValidationErrorItem(r,"notNull Violation",e,i,this.entityInstance,"is_null"))}t.type instanceof S.String&&(!Array.isArray(i)&&(!a.a.isObject(i)||i instanceof L.ExoMethod||Buffer.isBuffer(i))||this.errors.push(new l.a.ValidationErrorItem(`${e} cannot be an array or an object`,"string violation",e,i,this.entityInstance,"not_a_string")))}_handleReflectedResult(t,e,i){for(const r of i)if(r.isRejected()){const i=r.error(),s=!!i.validatorName;this._pushError(s,t,i,e,i.validatorName,i.validatorArgs)}}_pushError(t,e,i,r,s,n){const a=i.message||i||"Validation error",o=new l.a.ValidationErrorItem(a,"Validation error",e,r,this.entityInstance,s,t?s:void 0,t?n:void 0);o[Q.RAW_KEY_NAME]=i,this.errors.push(o)}}Q.RAW_KEY_NAME="original",Q.prototype.InstanceValidator=Q;var z=Q,W=i(1),G=i.n(W),Y=i(14);L.dd;const X=new Set(["where","attributes","paranoid","include","order","limit","offset","transaction","lock","raw","logging","benchmark","having","searchPath","rejectOnEmpty","plain","scope","group","through","defaults","distinct","primary","exception","type","hooks","force","name"]),J=["include","attributes","originalAttributes","order","where","limit","offset","plain","group","having"];class Z{static get QueryInterface(){return this.exo.getQueryInterface()}get exo(){return this.constructor.exo}constructor(t={},e={}){(e=Object.assign({isNewRecord:!0},e||{})).attributes&&(e.attributes=e.attributes.map(t=>Array.isArray(t)?t[1]:t)),e.expand&&a.a.isString(e.expand)&&(e.expand=[e.expand]),e.includeValidated||(this.constructor._conformIncludes(e,this.constructor),e.include&&(this.constructor._expandIncludeAll(e),this.constructor._validateIncludedElements(e))),this.dataValues={},this.odataValues={},this._previousDataValues={},this._changed={},this._entityOptions=this.constructor.options,this._options=e||{},this.isNewRecord=e.isNewRecord,this._initValues(t,e)}_initValues(t,e){let i,r;if(t=t&&a.a.clone(t)||{},e.isNewRecord&&(i={},this.constructor._hasDefaultValues&&(i=a.a.mapValues(this.constructor._defaultValues,t=>{const e=t();return e&&e instanceof L.ExoMethod?e:a.a.cloneDeep(e)})),Object.keys(i).length))for(r in i)void 0===t[r]&&(this.set(r,L.toDefaultValue(i[r]),{raw:!0}),delete t[r]);this.set(t,e)}static getTableName(){return this.tableName}toString(){return`[object ExoInstance:${this.constructor.name}]`}static init(t,e={}){if(!e.exo)throw new Error("No Exo instance passed");this.exo=e.exo;const i=this.exo.options;(e=L.merge(a.a.cloneDeep(i.define),e)).entityName||(e.entityName=this.name),e=L.merge({name:e.entityName,indexes:[],omitNull:i.omitNull,schema:i.schema,navigations:[]},e),this.exo.runHooks("beforeDefine",t,e),e.entityName!==this.name&&Object.defineProperty(this,"name",{value:e.entityName}),delete e.entityName,this.options=Object.assign({validate:{},paranoid:!1,rejectOnEmpty:!1,whereCollection:null,schema:null,schemaDelimiter:"",defaultScope:{},scopes:{},indexes:[]},e),this.exo.isDefined(this.name)&&this.exo.entityManager.removeEntity(this.exo.entityManager.getEntity(this.name)),this.is_custom_table=!0===this.options.custom_table,this.associations={},this._setupHooks(e.hooks),this.options.tableName?this.tableName=this.options.tableName:this.tableName=this.options.tableName=this.name;const r=this.tableName;return this._schema=this.options.schema,this._schemaDelimiter=this.options.schemaDelimiter,a.a.each(e.validate,(e,i)=>{if(t.hasOwnProperty(i))throw new Error(`A entity validator function must not have the same name as a field. Entity: ${this.name}, field/validation name: ${i}`);if("function"!=typeof e)throw new Error(`Members of the validate option must be functions. Entity: ${this.name}, error with validate member ${i}`)}),this.rawAttributes=a.a.mapValues(t,(t,e)=>{if(void 0===(t=this.exo.normalizeAttribute(t)).type)throw new Error(`Unrecognized datatype for attribute "${this.name}.${e}"`);if(!1!==t.allowNull&&a.a.get(t,"validate.notNull"))throw new Error(`Invalid definition for "${this.name}.${e}", "notNull" validator is only allowed with "allowNull:false"`);return a.a.get(t,"references.entity.prototype")instanceof Z&&(t.references.entity=t.references.entity.getTableName()),t}),this._indexes=this.options.indexes.map(t=>L.nameIndex(this._conformIndex(t),r)),this.primaryKeys={},this._readOnlyAttributes=new Set,this._expands=new Set(this.options.navigations.map(t=>"object"==typeof t?t.Name:t)),this._hasReadOnlyAttributes=this._readOnlyAttributes.size>0,this._addDefaultAttributes(),this.refreshAttributes(),this._findAutoIncrementAttribute(),this._scope=this.options.defaultScope,this._scopeNames=["defaultScope"],this.exo.entityManager.addEntity(this),this.exo.runHooks("afterDefine",this),this}static _conformIndex(t){if(!t.fields)throw new Error('Missing "fields" property for index definition');return(t=a.a.defaults(t,{type:"",parser:null})).type&&"unique"===t.type.toLowerCase()&&(t.unique=!0,delete t.type),t}static _addDefaultAttributes(){let t={};if(!a.a.some(this.rawAttributes,"primaryKey")){if("id"in this.rawAttributes)throw new Error(`A column called 'id' was added to the attributes of '${this.tableName}' but not marked with 'primaryKey: true'`);t={id:{type:new S.Integer,allowNull:!1,primaryKey:!0,autoIncrement:!0,_autoGenerated:!0}}}const e=a.a.clone(this.rawAttributes);this.rawAttributes={},a.a.each(t,(t,e)=>{this.rawAttributes[e]=t}),a.a.each(e,(t,e)=>{this.rawAttributes[e]=t}),a.a.each({},(t,e)=>{void 0===this.rawAttributes[e]&&(this.rawAttributes[e]=t)}),Object.keys(this.primaryKeys).length||(this.primaryKeys.id=this.rawAttributes.id)}static _findAutoIncrementAttribute(){this.autoIncrementAttribute=null;for(const t in this.rawAttributes)if(this.rawAttributes.hasOwnProperty(t)){const e=this.rawAttributes[t];if(e&&e.autoIncrement){if(this.autoIncrementAttribute)throw new Error("Invalid Instance definition. Only one autoincrement field allowed.");this.autoIncrementAttribute=t}}}static refreshAttributes(){const t={};this.prototype._customGetters={},this.prototype._customSetters={},["get","set"].forEach(e=>{const i=`${e}terMethods`,r=a.a.clone(a.a.isObject(this.options[i])?this.options[i]:{}),s="get"===e?this.prototype._customGetters:this.prototype._customSetters;a.a.each(r,(t,i)=>{s[i]=t,"get"===e&&(r[i]=function(){return this.get(i)}),"set"===e&&(r[i]=function(t){return this.set(i,t)})}),a.a.each(this.rawAttributes,(t,i)=>{t.hasOwnProperty(e)&&(s[i]=t[e]),"get"===e&&(r[i]=function(){return this.get(i)}),"set"===e&&(r[i]=function(t){return this.set(i,t)})}),Array.isArray(this.options.navigations)&&a.a.each(this.options.navigations,t=>{const i="object"==typeof t?t.Name:t;"get"===e&&(r[i]=function(){return this.get(i)}),"set"===e&&(r[i]=function(t){return this.set(i,t)})}),a.a.each(r,(i,r)=>{t[r]||(t[r]={configurable:!0}),t[r][e]=i})}),this._dataTypeChanges={},this._dataTypeSanitizers={},this._jsonAttributes=new Set,this._virtualAttributes=new Set,this._defaultValues={},this.prototype.validators={},this.fieldRawAttributesMap={},this.primaryKeys={},this.uniqueKeys={},a.a.each(this.rawAttributes,(t,e)=>{if(t.type=this.exo.normalizeDataType(t.type),t.Entity=this,t.fieldName=e,t._entityAttribute=!0,void 0===t.field&&(t.field=e),!0===t.primaryKey&&(this.primaryKeys[e]=t),this.fieldRawAttributesMap[t.field]=t,t.type._sanitize&&(this._dataTypeSanitizers[e]=t.type._sanitize),t.type._isChanged&&(this._dataTypeChanges[e]=t.type._isChanged),t.type instanceof S.Boolean?this._hasBooleanAttributes=!0:(t.type instanceof S.Date||t.type instanceof S.DateTime)&&(this._hasDateAttributes=!0),t.hasOwnProperty("defaultValue")&&(this._defaultValues[e]=()=>L.toDefaultValue(t.defaultValue)),t.hasOwnProperty("unique")&&t.unique){let i;i="object"==typeof t.unique&&t.unique.hasOwnProperty("name")?t.unique.name:"string"==typeof t.unique?t.unique:`${this.tableName}_${e}_unique`;const r=this.uniqueKeys[i]||{fields:[]};r.fields.push(t.field),r.msg=r.msg||t.unique.msg||null,r.name=i||!1,r.column=e,r.customIndex=!0!==t.unique,this.uniqueKeys[i]=r}t.hasOwnProperty("validate")&&(this.prototype.validators[e]=t.validate)}),this.fieldAttributeMap=a.a.reduce(this.fieldRawAttributesMap,(t,e,i)=>(i!==e.fieldName&&(t[i]=e.fieldName),t),{}),this._hasJsonAttributes=!!this._jsonAttributes.size,this._hasVirtualAttributes=!!this._virtualAttributes.size,this._hasDefaultValues=!a.a.isEmpty(this._defaultValues),this.tableAttributes=a.a.omitBy(this.rawAttributes,(t,e)=>this._virtualAttributes.has(e)),this.prototype._hasCustomGetters=Object.keys(this.prototype._customGetters).length,this.prototype._hasCustomSetters=Object.keys(this.prototype._customSetters).length;for(const e of Object.keys(t))Z.prototype.hasOwnProperty(e)?this.exo.log(`Not overriding built-in method from entity attribute: ${e}`):Object.defineProperty(this.prototype,e,t[e]);this.prototype.rawAttributes=this.rawAttributes,this.prototype._isAttribute=t=>this.prototype.rawAttributes.hasOwnProperty(t),this.primaryKeyAttributes=Object.keys(this.primaryKeys),this.primaryKeyAttribute=this.primaryKeyAttributes[0],this.primaryKeyAttribute&&(this.primaryKeyField=this.rawAttributes[this.primaryKeyAttribute].field||this.primaryKeyAttribute),this._hasPrimaryKeys=this.primaryKeyAttributes.length>0,this._isPrimaryKey=t=>this.primaryKeyAttributes.includes(t)}set(t,e,i){let r,s;if("object"==typeof t&&null!==t){if(r=t,(i=e||{}).reset){this.dataValues={};for(const t in r)this.changed(t,!1);this.odataValues={}}if(!i.raw||this._options&&this._options.include||i&&i.attributes||this.constructor._hasDateAttributes||this.constructor._hasBooleanAttributes){if(i.attributes){const t=t=>{for(const e of t)void 0!==r[e]&&this.set(e,r[e],i)};t(i.attributes),this.constructor._hasVirtualAttributes&&t(this.constructor._virtualAttributes),this._options.includeNames&&t(this._options.includeNames),(t=>{for(const e of t)void 0!==r[e]&&(this.odataValues[e]=r[e])})(["@odata.id","@odata.etag","@odata.editLink"])}else for(const t in r)this.set(t,r[t],i);i.raw&&(this._previousDataValues=a.a.clone(this.dataValues)),Array.isArray(i.expand)&&i.expand.length>0&&this.constructor._expands.size>0&&i.expand.map(t=>{this.constructor._expands.has(t)&&this.set(t,r[t]?r[t]:[],i)})}else Object.keys(this.dataValues).length?this.dataValues=Object.assign(this.dataValues,r):this.dataValues=r,this._previousDataValues=a.a.clone(this.dataValues);return this}if(i||(i={}),i.raw||(s=this.dataValues[t]),!i.raw&&this._customSetters[t]){this._customSetters[t].call(this,e,t);const i=this.dataValues[t];(!L.isPrimitive(i)&&null!==i||i!==s)&&(this._previousDataValues[t]=s,this.changed(t,!0))}else{if(this._options&&this._options.include&&this._options.includeNames.includes(t))return this._setInclude(t,e,i),this;if(!i.raw){if(!this._isAttribute(t)){if(t.includes(".")&&this.constructor._jsonAttributes.has(t.split(".")[0])){const i=U.a.get(this.dataValues,t);a.a.isEqual(i,e)||(U.a.set(this.dataValues,t,e),this.changed(t.split(".")[0],!0))}if(!Array.isArray(this._options.expand)||!this._options.expand.includes(t))return this}if(this.constructor._hasPrimaryKeys&&s&&this.constructor._isPrimaryKey(t))return this;if(!this.isNewRecord&&this.constructor._hasReadOnlyAttributes&&this.constructor._readOnlyAttributes.has(t))return this}e instanceof L.ExoMethod||!this.constructor._dataTypeSanitizers.hasOwnProperty(t)||(e=this.constructor._dataTypeSanitizers[t].call(this,e,i)),!i.raw&&(e instanceof L.ExoMethod||!(e instanceof L.ExoMethod)&&this.constructor._dataTypeChanges[t]&&this.constructor._dataTypeChanges[t].call(this,e,s,i)||!this.constructor._dataTypeChanges[t]&&(!L.isPrimitive(e)&&null!==e||e!==s))&&(this._previousDataValues[t]=s,this.changed(t,!0)),this.dataValues[t]=e}return this}previous(t){return t?this._previousDataValues[t]:a.a.pickBy(this._previousDataValues,(t,e)=>this.changed(e))}_setInclude(t,e,i){Array.isArray(e)||(e=[e]),e[0]instanceof Z&&(e=e.map(t=>t.dataValues));const r=this._options.includeMap[t],s=r.association,n=t,a=r.entity.primaryKeyAttribute;let o,u;u||(o={isNewRecord:this.isNewRecord,include:r.include,includeNames:r.includeNames,includeMap:r.includeMap,includeValidated:!0,raw:i.raw,attributes:r.originalAttributes}),(void 0===r.originalAttributes||r.originalAttributes.length)&&(s.isSingleAssociation?(Array.isArray(e)&&(e=e[0]),u=e&&null===e[a]||null===e,this[n]=this.dataValues[n]=u?null:r.entity.build(e,o)):(u=e[0]&&null===e[0][a],this[n]=this.dataValues[n]=u?[]:r.entity.bulkBuild(e,o)))}changed(t,e){if(t)return void 0!==e?(this._changed[t]=e,this):this._changed[t]||!1;const i=Object.keys(this.dataValues).filter(t=>this.changed(t));return!!i.length&&i}static getAvailableExpands(t=!1){return Array.isArray(this.options.navigations)?t?this.options.navigations:this.options.navigations.map(t=>t.Name):[]}static find(t,e){return"object"==typeof t?this.findAll(t,e):this.findByPk(t,e)}static findByPk(t,e){if([null,void 0].includes(t))return K.a.resolve(null);if(e=L.cloneDeep(e)||{},"number"!=typeof t&&"string"!=typeof t&&!Buffer.isBuffer(t))throw new Error(`Argument passed to findByPk is invalid: ${t}`);return e.where={[this.primaryKeyAttribute]:t},this.findOne(e)}static findOne(t){if(void 0!==t&&!a.a.isPlainObject(t))throw new Error("The argument passed to findOne must be an options object, use findByPk if you wish to pass a single primary key value");if(void 0===(t=L.cloneDeep(t)).limit){const e=a.a.chain(this.uniqueKeys).values().filter(t=>1===t.fields.length).map("column").value();t.where&&a.a.some(t.where,(t,i)=>(i===this.primaryKeyAttribute||e.includes(i))&&(L.isPrimitive(t)||Buffer.isBuffer(t)))||(t.limit=1)}return this.findAll(a.a.defaults(t,{plain:!0}))}static aggregate(t,e,i){const r=(i=L.cloneDeep(i)).attributes;i.attributes=r,this._conformIncludes(i,this),i.include&&(this._expandIncludeAll(i),this._validateIncludedElements(i));const s=this.rawAttributes[t],n=s&&s.field||t;let o=this.exo.col(n);i.distinct&&(o=this.exo.fn("DISTINCT",o));let{group:u}=i;return Array.isArray(u)&&Array.isArray(u[0])&&(Object(Y.noDoubleNestedGroup)(),u=a.a.flatten(u)),i.attributes=a.a.unionBy(i.attributes,u,[[this.exo.fn(e,o),e]],t=>Array.isArray(t)?t[1]:t),i.dataType?i.dataType=this.exo.normalizeDataType(i.dataType):i.dataType=s?s.type:new S.Float,L.mapOptionFieldNames(i,this),this.QueryInterface.rawSelect(this,i,e).then(t=>null===t?0:t)}static async count(t){return await this.QueryInterface.count(this,t)}static findAndCountAll(t){if(void 0!==t&&!a.a.isPlainObject(t))throw new Error("The argument passed to findAndCountAll must be an options object, use findByPk if you wish to pass a single primary key value");const e=L.cloneDeep(t);return e.attributes&&(e.attributes=void 0),K.a.all([this.count(e),this.findAll(t)]).then(([t,e])=>({count:t,rows:0===t?[]:e}))}static async search(t){let e=await this.exo.getEntityData(this.tableName+"/search?q="+t);return e&&e.value&&Array.isArray(e.value)?this.bulkBuild(e.value,{isNewRecord:!1,raw:!0,expand:this.options.expand||null}):[]}static async findAll(t){if(void 0!==t&&!a.a.isPlainObject(t))throw new l.a.QueryError("The argument passed to findAll must be an options object, use findByPk if you wish to pass a single primary key value");if(void 0!==t&&t.attributes&&!Array.isArray(t.attributes)&&!a.a.isPlainObject(t.attributes))throw new l.a.QueryError("The attributes option must be an array of column names or an object");this.warnOnInvalidOptions(t,Object.keys(this.rawAttributes));const e={};let i;e[this.getTableName(t)]=!0,(t=L.cloneDeep(t)).expand&&a.a.isString(t.expand)&&(t.expand=[t.expand]),a.a.defaults(t,{hooks:!0,pagesize:100}),t.rejectOnEmpty=t.hasOwnProperty("rejectOnEmpty")?t.rejectOnEmpty:this.options.rejectOnEmpty,t.hooks&&await this.runHooks("beforeFind",t),this._conformIncludes(t,this),this._expandAttributes(t),this._expandIncludeAll(t),t.hooks&&await this.runHooks("beforeFindAfterExpandIncludeAll",t),t.originalAttributes=this._injectDependentVirtualAttributes(t.attributes),t.include&&(t.hasJoin=!0,this._validateIncludedElements(t,e),!t.attributes||t.raw||!this.primaryKeyAttribute||t.attributes.includes(this.primaryKeyAttribute)||t.group&&t.hasSingleAssociation&&!t.hasMultiAssociation||(t.attributes=[this.primaryKeyAttribute].concat(t.attributes))),t.attributes||(t.attributes=Object.keys(this.rawAttributes),t.originalAttributes=this._injectDependentVirtualAttributes(t.attributes)),this.options.whereCollection=t.where||null,L.mapFinderOptions(t,this),t.hooks&&await this.runHooks("beforeFindAfterOptions",t),i=L.cloneDeep(t),t.tableNames=Object.keys(e);const r=await this.QueryInterface.select(this,t);if(t.hooks&&await this.runHooks("afterFind",r,t),a.a.isEmpty(r)&&t.rejectOnEmpty){if("function"==typeof t.rejectOnEmpty)throw new t.rejectOnEmpty;if("object"==typeof t.rejectOnEmpty)throw t.rejectOnEmpty;throw new l.a.EmptyResultError}return await Z._findSeparate(r,i)}static async _findSeparate(t,e){if(!e.include||e.raw||!t)return t;const i=t;return e.plain&&(t=[t]),t.length?K.a.map(e.include,i=>i.separate?i.association.get(t,Object.assign({},a.a.omit(e,J),a.a.omit(i,["parent","association","as","originalAttributes"]))).then(e=>{for(const r of t)r.set(i.association.as,e[r.get(i.association.sourceKey)],{raw:!0})}):Z._findSeparate(t.reduce((t,e)=>{let r=e.get(i.association.as);if(!r)return t;Array.isArray(r)||(r=[r]);for(let e=0,i=r.length;e!==i;++e)t.push(r[e]);return t},[]),Object.assign({},a.a.omit(e,"include","attributes","order","where","limit","offset","plain","scope"),{include:i.include||[]}))).return(i):i}static _validateIncludedElements(t,e){t.entity||(t.entity=this),e=e||{},t.includeNames=[],t.includeMap={},t.hasSingleAssociation=!1,t.hasMultiAssociation=!1,t.parent||(t.topEntity=t.entity,t.topLimit=t.limit),t.include=t.include.map(i=>((i=this._conformInclude(i)).parent=t,i.topLimit=t.topLimit,this._validateIncludedElement.call(t.entity,i,e,t),void 0===i.duplicating&&(i.duplicating=i.association.isMultiAssociation),i.hasDuplicating=i.hasDuplicating||i.duplicating,i.hasRequired=i.hasRequired||i.required,t.hasDuplicating=t.hasDuplicating||i.hasDuplicating,t.hasRequired=t.hasRequired||i.required,t.hasWhere=t.hasWhere||i.hasWhere||!!i.where,i));for(const e of t.include)e.hasParentWhere=t.hasParentWhere||!!t.where,e.hasParentRequired=t.hasParentRequired||!!t.required,!1!==e.subQuery&&t.hasDuplicating&&t.topLimit?e.duplicating?(e.subQuery=!1,e.subQueryFilter=e.hasRequired):(e.subQuery=e.hasRequired,e.subQueryFilter=!1):(e.subQuery=e.subQuery||!1,e.duplicating?(e.subQueryFilter=e.subQuery,e.subQuery=!1):(e.subQueryFilter=!1,e.subQuery=e.subQuery||e.hasParentRequired&&e.hasRequired)),t.includeMap[e.as]=e,t.includeNames.push(e.as),t.topEntity===t.entity&&void 0===t.subQuery&&t.topLimit&&(e.subQuery?t.subQuery=e.subQuery:e.hasDuplicating&&(t.subQuery=!0)),t.hasIncludeWhere=t.hasIncludeWhere||e.hasIncludeWhere||!!e.where,t.hasIncludeRequired=t.hasIncludeRequired||e.hasIncludeRequired||!!e.required,(e.association.isMultiAssociation||e.hasMultiAssociation)&&(t.hasMultiAssociation=!0),(e.association.isSingleAssociation||e.hasSingleAssociation)&&(t.hasSingleAssociation=!0);return t.topEntity===t.entity&&void 0===t.subQuery&&(t.subQuery=!1),t}static _validateIncludedElement(t,e,i){if(e[t.entity.getTableName()]=!0,t.attributes&&!i.raw?(t.entity._expandAttributes(t),t.originalAttributes=this._injectDependentVirtualAttributes(t.attributes),(t=L.mapFinderOptions(t,t.entity)).attributes.length&&a.a.each(t.entity.primaryKeys,(e,i)=>{t.attributes.some(t=>e.field!==i?Array.isArray(t)&&t[0]===e.field&&t[1]===i:t===i)||t.attributes.unshift(i)})):t=L.mapFinderOptions(t,t.entity),t._pseudo)return t.attributes=Object.keys(t.entity.tableAttributes),L.mapFinderOptions(t,t.entity);const r=t.association||this._getIncludedAssociation(t.entity,t.as);if(t.association=r,t.as=r.as,t.association.through&&Object(t.association.through.entity)===t.association.through.entity){t.include||(t.include=[]);const i=t.association.through;t.through=a.a.defaults(t.through||{},{entity:i.entity,as:i.entity.name,association:{isSingleAssociation:!0},_pseudo:!0,parent:t}),i.scope&&(t.through.where=t.through.where?{[G.a.and]:[t.through.where,i.scope]}:i.scope),t.include.push(t.through),e[i.tableName]=!0}let s;if(s=!0===t.entity.scoped?t.entity:t.association.target.name===t.entity.name?t.association.target:t.association.source,t.attributes||(t.attributes=Object.keys(t.entity.tableAttributes)),void 0===(t=L.mapFinderOptions(t,t.entity)).required&&(t.required=!!t.where),t.association.scope&&(t.where=t.where?{[G.a.and]:[t.where,t.association.scope]}:t.association.scope),t.limit&&void 0===t.separate&&(t.separate=!0),!0===t.separate){if(!(t.association instanceof HasMany))throw new Error("Only HasMany associations support include.separate");t.duplicating=!1,i.attributes&&i.attributes.length&&!a.a.flattenDepth(i.attributes,2).includes(r.sourceKey)&&i.attributes.push(r.sourceKey),t.attributes&&t.attributes.length&&!a.a.flattenDepth(t.attributes,2).includes(r.foreignKey)&&t.attributes.push(r.foreignKey)}return t.hasOwnProperty("include")&&this._validateIncludedElements.call(t.entity,t,e),t}static _injectDependentVirtualAttributes(t){if(!this._hasVirtualAttributes)return t;if(!t||!Array.isArray(t))return t;for(const e of t)this._virtualAttributes.has(e)&&this.rawAttributes[e].type.fields&&(t=t.concat(this.rawAttributes[e].type.fields));return t=a.a.uniq(t)}static _conformInclude(t,e){if(t){let i;if(t._pseudo)return t;if((t=this._transformStringAssociation(t,e))instanceof Association)return{entity:i=e&&t.target.name===e.name?t.source:t.target,association:t,as:t.as};if(t.prototype&&t.prototype instanceof Z)return{entity:t};if(a.a.isPlainObject(t)){if(t.association)return t.association=this._transformStringAssociation(t.association,e),i=e&&t.association.target.name===e.name?t.association.source:t.association.target,t.entity||(t.entity=i),t.as||(t.as=t.association.as),this._conformIncludes(t,i),t;if(t.entity)return this._conformIncludes(t,t.entity),t;if(t.all)return this._conformIncludes(t),t}}throw new Error("Include unexpected. Element has to be either a Entity, an Association or an object.")}static _conformIncludes(t,e){if(t.include){if(Array.isArray(t.include)){if(!t.include.length)return void delete t.include}else t.include=[t.include];t.include=t.include.map(t=>this._conformInclude(t,e))}}static _expandAttributes(t){if(!a.a.isPlainObject(t.attributes))return;let e=Object.keys(this.rawAttributes);t.attributes.exclude&&(e=e.filter(e=>!t.attributes.exclude.includes(e))),t.attributes.include&&(e=e.concat(t.attributes.include)),t.attributes=e}static _expandIncludeAll(t){const e=t.include;if(e){for(let t=0;t<e.length;t++){const i=e[t];i.all&&(e.splice(t,1),t--,this._expandIncludeAllElement(e,i))}e.forEach(t=>{this._expandIncludeAll.call(t.entity,t)})}}static _expandIncludeAllElement(t,e){let i=e.all;if(delete e.all,!0!==i){Array.isArray(i)||(i=[i]);const t={BelongsTo:!0,HasOne:!0,HasMany:!0,One:["BelongsTo","HasOne"],Has:["HasOne","HasMany"],Many:["HasMany"]};for(let e=0;e<i.length;e++){const r=i[e];if("All"===r){i=!0;break}const s=t[r];if(!s)throw new l.a.EagerLoadingError(`include all '${r}' is not valid - must be BelongsTo, HasOne, HasMany, One, Has, Many or All`);if(!0!==s){i.splice(e,1),e--;for(let t=0;t<s.length;t++)i.includes(s[t])||(i.unshift(s[t]),e++)}}}const r=e.nested;r&&(delete e.nested,e.include?Array.isArray(e.include)||(e.include=[e.include]):e.include=[]);const s=[];!function t(n,o){a.a.forEach(n.associations,u=>{if(!0!==i&&!i.includes(u.associationType))return;const c=u.target,l=u.options.as,h={entity:c};if(l&&(h.as=l),a.a.some(o,h))return;if(r&&s.includes(c))return;s.push(n);const p=L.cloneDeep(e);p.entity=c,l&&(p.as=l),o.push(p),r&&(t(c,p.include),0===p.include.length&&delete p.include)}),s.pop()}(this,t)}static warnOnInvalidOptions(t,e){if(!a.a.isPlainObject(t))return;const i=Object.keys(t).filter(t=>!X.has(t)),r=a.a.intersection(i,e);!t.where&&r.length>0&&logger.warn(`Entity attributes (${r.join(", ")}) passed into finder method options of entity ${this.name}, but the options.where object is empty. Did you forget to use options.where?`)}static build(t,e){return Array.isArray(t)?this.bulkBuild(t,e):new this(t,e)}static bulkBuild(t,e){return(e=Object.assign({isNewRecord:!0},e||{})).includeValidated||(this._conformIncludes(e,this),e.include&&(this._expandIncludeAll(e),this._validateIncludedElements(e))),e.attributes&&(e.attributes=e.attributes.map(t=>Array.isArray(t)?t[1]:t)),t.map(t=>this.build(t,e))}toJSON(){return a.a.cloneDeep(this.get({plain:!0}))}toJson(){return this.toJSON()}toString(){return`[object ExoInstance:${this.constructor.name}]`}getDataValue(t){return this.dataValues[t]}setDataValue(t,e){const i=this._previousDataValues[t];(!L.isPrimitive(e)&&null!==e||e!==i)&&this.changed(t,!0),this.dataValues[t]=e}get(t,e){if(void 0===e&&"object"==typeof t&&(e=t,t=void 0),e=e||{},t)return this._customGetters.hasOwnProperty(t)&&!e.raw?this._customGetters[t].call(this,t,e):e.plain&&this._options.include&&this._options.includeNames.includes(t)?Array.isArray(this.dataValues[t])?this.dataValues[t].map(t=>t.get(e)):this.dataValues[t]instanceof Z?this.dataValues[t].get(e):this.dataValues[t]:this.dataValues[t];if(this._hasCustomGetters||e.plain&&this._options.include||e.clone){const t={};let i;if(this._hasCustomGetters)for(i in this._customGetters)this._options.attributes&&!this._options.attributes.includes(i)||this._customGetters.hasOwnProperty(i)&&(t[i]=this.get(i,e));for(i in this.dataValues)!t.hasOwnProperty(i)&&this.dataValues.hasOwnProperty(i)&&(t[i]=this.get(i,e));return t}return this.dataValues}async save(t){if(arguments.length>1)throw new Error("The second argument was removed in favor of the options object.");t=L.cloneDeep(t),(t=a.a.defaults(t,{hooks:!0,validate:!0})).fields||(this.isNewRecord,t.fields=Object.keys(this.constructor.rawAttributes),Array.isArray(this._options.expand)&&(t.fields=t.fields.concat(this._options.expand)),t.defaultFields=t.fields),void 0===t.returning&&(t.association?t.returning=!1:this.isNewRecord&&(t.returning=!0));const e=this.constructor.primaryKeyAttribute,i=e&&this.constructor.rawAttributes[e],r=this.isNewRecord?"Create":"Update",s=this.isNewRecord;L.now();if(!0===this.isNewRecord&&i&&i.defaultValue&&!t.fields.includes(e)&&t.fields.unshift(e),!1===this.isNewRecord&&e&&void 0===this.get(e,{raw:!0}))throw new Error("You attempted to save an instance with no primary key, this is not allowed since it would result in a global update");if(t.validate&&await this.validate(t),t.hooks){const e=a.a.pick(this.dataValues,t.fields);let i,s=a.a.difference(this.changed(),t.fields),n=[];if(await this.constructor.runHooks(`before${r}`,this,t),t.defaultFields&&!this.isNewRecord){i=a.a.pick(this.dataValues,a.a.difference(this.changed(),s)),n=[];for(const t of Object.keys(i))i[t]!==e[t]&&n.push(t);t.fields=a.a.uniq(t.fields.concat(n))}n.length>0&&t.validate&&(t.skip=a.a.difference(Object.keys(this.constructor.rawAttributes),n),await this.validate(t).then(()=>{delete t.skip}))}if(!t.fields.filter(t=>!this.constructor._virtualAttributes.has(t)).length)return this;if(!this.changed()&&!this.isNewRecord)return this;let n=L.mapValueFieldNames(this.dataValues,t.fields,this.constructor),o=null,u=[];s?(null===n[e]&&delete n[e],o="insert",u=[this,n,t]):(o="update",u=[this,n,t]);const c=this.constructor;let l=(await c.QueryInterface[o](...u))[c.primaryKeyAttribute];if(c.rawAttributes[c.primaryKeyAttribute].type instanceof S.Integer&&"string"==typeof l&&(l=parseInt(l)),!s&&this.getPrimaryKey()!==l)throw new Error("Primary Key inconsistency before("+l+") and after update("+this.getPrimaryKey()+"). ");const h={};this._options.expand&&(h.expand=this._options.expand);let p=await c.findByPk(l,h);this.setODataValues(p.getODataValues());for(const t of Object.keys(this.constructor.rawAttributes))this.constructor.rawAttributes[t].field&&void 0!==n[this.constructor.rawAttributes[t].field]&&this.constructor.rawAttributes[t].field!==t&&(n[t]=n[this.constructor.rawAttributes[t].field],delete n[this.constructor.rawAttributes[t].field]);n=Object.assign(n,p.dataValues),this.dataValues=Object.assign(this.dataValues,n),t.hooks&&await this.constructor.runHooks(`after${r}`,this,t);for(const e of t.fields)this._previousDataValues[e]=this.dataValues[e],this.changed(e,!1);return this.isNewRecord=!1,p=null,this}validate(t){return new z(this,t).validate()}where(t){const e=this.constructor.primaryKeyAttributes.reduce((t,e)=>(t[e]=this.get(e,{raw:!0}),t),{});return 0===a.a.size(e)?this._entityOptions.whereCollection:L.mapWhereFieldNames(e,this.constructor)}getPrimaryKeyAttribute(){return this.constructor.rawAttributes[this.constructor.primaryKeyAttribute]}getPrimaryKey(){return this.get(this.constructor.primaryKeyAttribute)}setODataValues(t){this.odataValues=t}getODataValues(){return this.odataValues}getODataValue(t){return this.odataValues["@odata."+t]}setODataValue(t,e){this.odataValues["@odata."+t]=e}async delete(t){(t=Object.assign({hooks:!0,force:!1},t)).hooks&&await this.constructor.runHooks("beforeDestroy",this,t);const e=await this.constructor.QueryInterface.delete(this,t);return t.hooks&&await this.constructor.runHooks("afterDestroy",this,t),e[this.constructor.primaryKeyAttribute]===this.getPrimaryKey()}static create(t,e){return e=L.cloneDeep(e||{}),this.build(t,{isNewRecord:!0,attributes:e.fields,include:e.include,raw:e.raw,silent:e.silent,expand:e.expand||[]}).save(e)}}u.a.applyTo(Z),u.a.applyTo(Z.prototype);var tt=i(15),et=i.n(tt);console.log;const it=[G.a.eq,G.a.ne,G.a.gt,G.a.ge,G.a.lt,G.a.le,G.a.like],rt=[G.a.and,G.a.or,G.a.not],st=[G.a.any,G.a.all],nt=[G.a.startsWith,G.a.endsWith,G.a.contains],at=[G.a.expand,G.a.select,G.a.top,G.a.orderby,G.a.filter],ot=/\((.*)\)/;var ut=function(t){let{filter:e,where:i,limit:r,count:s,order:n,orderby:a,attributes:o,expand:u,pagesize:c}=t;const l={};if(i=Object.assign({},i,e)){const t=ct(i);t&&(l.$filter=t)}if(c&&(l.pagesize=r&&r<c?r:c),!n&&a&&(n=a),n){const t=ht(n);t&&(l.$orderby=t)}if(u){const t=function t(e){if("number"==typeof e)return e;if("string"==typeof e)return-1===e.indexOf("/")?e:e.split("/").reverse().reduce((t,e,i,r)=>0===i?`$expand=${e}`:i===r.length-1?`${e}(${t})`:`$expand=${e}(${t})`,"");if(Array.isArray(e))return`${e.map(e=>t(e)).join(",")}`;if("object"==typeof e){const i=Object.keys(e);return i.some(t=>-1!==at.indexOf(t.toLowerCase()))?i.map(i=>{const r=i===G.a.filter?ct(e[i]):i===G.a.orderby?ht(e[i]):t(e[i]);return`$${i.toLowerCase()}=${r}`}).join(";"):i.map(i=>{const r=t(e[i]);return r?`${i}(${r})`:i}).join(",")}}(u);l.$expand=t}if(s)throw new Error("Should use Entity.count() to get the amount");return function(t,e){return Object.keys(e).length?t+"?"+Object.keys(e).map(t=>`${t}=${e[t]}`).join("&"):t}("",l)};function ct(t={},e=""){if(!t)return null;if("string"==typeof t)return t;if(!Array.isArray(t)){if("object"==typeof t){return Object.keys(t).reduce((i,r)=>{const s=t[r],n=e?ot.test(r)?r.replace(ot,`(${e}/$1)`):`(${e}/${r}`:r;if(-1!==["number","string","boolean"].indexOf(typeof s)||s instanceof Date||null===s)i.push(`${n} eq ${lt(s)}`);else if(Array.isArray(s)){const t=r,n=s.map(t=>ct(t,e)).filter(t=>void 0!==t).map(e=>-1!==rt.indexOf(t)?`(${e})`:e);n.length&&(-1!==rt.indexOf(t)?n.length&&(t===G.a.not?i.push(function(t,e){return e.length>1?`not( ${e.join(" and ")})`:e.map(t=>"("===t.charAt(0)?"(not ".concat(t.substr(1)):"not ".concat(t))}(0,n)):i.push(`(${n.join(` ${t} `)})`)):i.push(n.join(` ${t} `)))}else if(s instanceof Object)if("type"in s)i.push(`${n} eq ${lt(s)}`);else{Object.keys(s).forEach(t=>{if(-1!==it.indexOf(t))if(t===G.a.like){const e="%"===s[t][s[t].length-1],r="%"===s[t][0],o=a.a.replace(s[t],/%/g,"");let u;e&&r?u="contains":e?u="startswith":r&&(u="endswith"),u?i.push(`${u}(${n},${lt(o)})`):i.push(`${n} ${lt(o)}`)}else i.push(`${n} ${t} ${lt(s[t])}`);else if(-1!==rt.indexOf(t))Array.isArray(s[t])?i.push(s[t].map(t=>"("+ct(t,n)+")").join(` ${t} `)):i.push("("+ct(s[t],n)+")");else if(-1!==st.indexOf(t)){const e=r[0].toLowerCase(),a=ct(s[t],e);void 0!==a&&i.push(`${n}/${t}(${e}:${a})`)}else if(t===G.a.in){const e=Array.isArray(s[t])?s[t]:s[t].value.map(e=>({type:s[t].type,value:e}));i.push("("+e.map(t=>`${n} eq ${lt(t)}`).join(" or ")+")")}else-1!==nt.indexOf(t)?i.push(`${t}(${n},${lt(s[t])})`):i.push(ct(s,n))})}else if(void 0!==s)throw new Error(`Unexpected value type: ${s}`);return i},[]).join(" and ")||void 0}throw new Error(`Unexpected filters type: ${t}`)}{const e=t.map(t=>ct(t).filter(t=>void 0!==t));if(e.length)return`${e.map(t=>`(${t})`).join(" and ")}`}}function lt(t){if("string"==typeof t)return`'${e=t,e=(e=(e=(e=(e=(e=(e=e.replace(/%/g,"%25")).replace(/\+/g,"%2B")).replace(/\//g,"%2F")).replace(/\?/g,"%3F")).replace(/#/g,"%23")).replace(/&/g,"%26")).replace(/'/g,"''")}'`;if(t instanceof Date)return t.toISOString();if(t instanceof Number)return t;if(Array.isArray(t)){return`[${t.map(t=>"string"==typeof t?`'${t}'`:t).join(",")}]`}switch(t&&t.type){case"guid":case"raw":return t.value}return t;var e}function ht(t){if("number"==typeof t)return t;if("string"==typeof t)return t;if(Array.isArray(t)){if(2===t.length&&"string"==typeof t[0]&&"string"==typeof t[1])return t.join(" ");{let e=[];return t.map(t=>{"string"==typeof t?e.push(t):e.push(t.join(" "))}),e.join(",")}}}console.log,G.a.eq,G.a.ne,G.a.gt,G.a.ge,G.a.lt,G.a.le,G.a.like,G.a.and,G.a.or,G.a.not,G.a.any,G.a.all,G.a.startsWith,G.a.endsWith,G.a.contains,G.a.expand,G.a.select,G.a.top,G.a.orderby,G.a.filter;var pt=i(8),dt=i.n(pt),yt=i(6),ft=i.n(yt);console.log;const gt=L.debug,mt={};class bt{constructor(t,e){e=e||{},this.odata=t,this.rootUrl=t.rootUrl||e.rootUrl,mt[this.rootUrl]?this.cache=mt[this.rootUrl]:this.cache=mt[this.rootUrl]={},this.instance=e.instance,this.entity=e.entity,this.options=Object.assign({plain:!1,raw:!1},e)}async run(t,e){let{sql:i,entity:r,type:n}=t;if(n===s.a.SELECT){let e=this.rootUrl;const s=r&&r.name?r.name:null;if(!s)throw new Error("Should not use this sectionsql:"+i);e=ft.a.resolve(e,r.name)+i;const n=(await this.get(e,t)).value;return s?this.formatResults(n):n}if(n===s.a.INSERT){let t=this.rootUrl;return(r&&r.name?r.name:null)&&(r.is_custom_table&&(t=ft.a.resolve(t,"CUSTOMTABLE/")),t=ft.a.resolve(t,r.name)),await this._insertEntity(t,e)}if(n!==s.a.UPDATE){if(n===s.a.DELETE){const{instance:e}=t;let i=e.getODataValue("editLink"),r=e.getODataValue("etag");if(!i)throw new Error("There is no editLink url for update.");return await this._deleteEntity(i,r)}throw new Error("The type["+n+"] has not been implemented in odbc/handler.js")}{const{instance:i}=t;i.getPrimaryKeyAttribute();i.getPrimaryKey();let r=i.getODataValue("editLink"),s=i.getODataValue("etag");try{if(!r)throw new Error("There is no editLink url for update.");return await this._updateEntity(r,e,s)}catch(t){throw t.is_etag?new Error("Your data has been updated by another person, please refresh the page and try again."):t}}}async _insertEntity(t,e){return await this.post(t,{body:JSON.stringify(e)})}async _updateEntity(t,e,i){const r={};return i&&(r["If-Match"]=i),await this.post(t,{method:"PUT",headers:r,body:JSON.stringify(e)})}async _deleteEntity(t,e){const i={};return e&&(i["If-Match"]=e),await this.post(t,{method:"DELETE",headers:i})}async getEntityData(t,e=!0){if(e&&this.cache[t])return this.cache[t];let i=ft.a.resolve(this.rootUrl,t);const r=await this.get(i);return e&&(this.cache[t]=r),r}async postDataToExo(t,e){let i=ft.a.resolve(this.rootUrl,t);return await this.post(i,{body:JSON.stringify(e)})}async getEntityXML(t,e=!0){if(e&&this.cache[t])return this.cache[t];let i=ft.a.resolve(this.rootUrl,t);const r=await dt()(i),s=await r.text();if(s.error)throw s.error;return s}formatResults(t){let e=this.instance;if(!this.isInsertQuery(t)){if(this.isSelectQuery())return this.handleSelectQuery(t);throw new Error("handler.js formatResult not implemented. ["+this.options.type+"]")}return e}parseLinks(t){const e={};return t?(t.split(",").map(t=>{let i="",r="",s="";if(t.toLowerCase().split(";").map(t=>{const e=t.indexOf("<"),n=t.indexOf(">"),a=t.indexOf('rel="'),o=t.indexOf('method="');-1!==e&&-1!==n?s=t.substring(e+1,n):-1!==a?i=t.substr(a+5).replace(/"/g,""):-1!==o&&(r=t.substr(o+8).replace(/"/g,""))}),i){e[i+(r?"_"+r:"")]={rel:i,method:r,url:s}}}),e):e}async get(t,e){try{e||(e={});const{limit:i}=e,r={Accept:"application/json","Content-Type":"application/json"},{token:s,username:n,password:a,cache_dir:o}=this.odata.exo.options;n&&a&&(r.Authorization="Basic "+new Buffer(n+":"+a).toString("base64")),s&&(r["x-myobapi-exotoken"]=s),gt("--- BEGIN GET REQUEST----------"),gt("url",t),gt("headers",r);let u=t,c=null,l=null,h=null,p=0;for(;u;){if(gt("tmp_url("+p+")",u),p++,200!==(h=await dt()(u,{headers:r})).status)throw new Error(h.status+" "+h.statusText);if((l=await h.json()).error)throw l.error;if(null===c?(c={}).value=[].concat(l):c.value=c.value.concat(l),i&&c.value.length>=i){c.value=c.value.slice(0,i);break}const t=this.parseLinks(h.headers.get("link"));u=t.next?t.next.url:""}return c&&c.value&&c.value.map(t=>{t.href&&(t["@odata.editLink"]=t.href)}),c}catch(t){let e="";throw"string"==typeof t?e=t:(e=t.message,Array.isArray(t.details)&&t.details.map(t=>{e+=" [ Code("+t.code+") - "+t.message+" ] "})),new Error(e)}}async post(t,e){try{gt("httpRequest[post]:",t,e),e=e||{};let{headers:i,...r}=e;i=Object.assign({Accept:"application/json","Content-Type":"application/json"},i||{});const{token:s,username:n,password:a,cache_dir:o}=this.odata.exo.options;n&&a&&(i.Authorization="Basic "+new Buffer(n+":"+a).toString("base64")),s&&(i["x-myobapi-exotoken"]=s),gt("--- BEGIN POST REQUEST----------"),gt("url",t),gt("headers",i),gt("body - ",typeof r.body,r.body),r=Object.assign({method:"POST",headers:i},r||{});const u=await dt()(t,r),c=await u.json();if(gt("---- END POST REQUEST---------"),200!==u.status&&201!==u.status&&202!==u.status)throw new Error(u.status+" "+u.statusText+JSON.stringify(c));return c}catch(t){let e=!1,i=t.message;Array.isArray(t.details)&&t.details.map(t=>{i+=" [ Code("+t.code+") - "+t.message+" ] ",-1===t.message.indexOf("If-Match")&&-1===t.message.indexOf("etag")||(e=!0)});const r=new Error(i);throw r.is_etag=e,r}}isSelectQuery(){return this.options.type===s.a.SELECT}handleSelectQuery(t){let e=null;if(this.options.fieldMap){const e=this.options.fieldMap;t=t.map(t=>_.reduce(e,(t,e,i)=>(void 0!==t[i]&&(t[e]=t[i],delete t[i]),t),t))}if(this.options.raw)throw gt("results",t),new Error("handler.js raw is not implemented");if(!0===this.options.hasJoin)throw new Error("handler.js hasJoin is not implemented");return e=this.entity.bulkBuild(t,{isNewRecord:!1,raw:!0,attributes:this.options.originalAttributes||this.options.attributes,expand:this.options.expand||null}),this.options.plain&&(e=0===e.length?null:e[0]),e}isInsertQuery(t,e){let i=!0;return this.options.type===s.a.INSERT||(i=(i=(i=i&&this.options.sql.toLowerCase().startsWith("insert into"))&&(!t||t.hasOwnProperty(this.getInsertIdField())))&&(!e||e.hasOwnProperty(this.getInsertIdField())))}getInsertIdField(){return"insertId"}}console.log;class wt{constructor(t){this.exo=t,this.rootUrl=t.rootUrl}select(t,e){(e=L.cloneDeep(e)).type=s.a.SELECT,e.entity=t;const i=ut(e);return e.sql=i,this.exo.query(i,e)}async count(t,e){throw new Error("Not Implemented.")}async insert(t,e,i){return(i=L.cloneDeep(i)).hasTrigger=t&&t.constructor.options.hasTrigger,i.type=s.a.INSERT,i.instance=t,await this.exo.insert(t,e,i)}async update(t,e,i,r){return(r=L.cloneDeep(r)).hasTrigger=t&&t.constructor.options.hasTrigger,r.type=s.a.INSERT,r.instance=t,await this.exo.update(t,e,i,r)}async delete(t,e){return(e=a.a.clone(e)||{}).type=s.a.DELETE,e.instance=t,await this.exo.delete(t,e)}getConnection(t){return new bt(this,t)}rawSelect(t,e,i){e=L.cloneDeep(e),e=a.a.defaults(e,{raw:!0,plain:!0,type:s.a.SELECT,entity:t});const r=ut(e);if(e.sql=r,void 0===i)throw new Error("Please pass an attribute selector!");return this.exo.query(r,e).then(t=>{if(!e.plain)return t;const r=t?t[i]:null;if(!e||!e.dataType)return r;const s=e.dataType;return(s instanceof DataTypes.DECIMAL||s instanceof DataTypes.FLOAT)&&null!==r?parseFloat(r):s instanceof DataTypes.INTEGER||s instanceof DataTypes.BIGINT?parseInt(r,10):s instanceof DataTypes.DATE&&null!==r&&!(r instanceof Date)?new Date(r):r})}static get Handler(){return bt}}i(26),i(27);var At=function(t){const e=t.constructor;if(t.isDefined("debtor"))return t.entity("debtor");const i=t.define("debtor",{id:{type:e.Integer,primaryKey:!0},accountname:{type:e.String},href:{type:e.String},rel:{type:e.String},latitude:{type:e.String},longitude:{type:e.String},email:{type:e.String},phone:{type:e.String},postaladdress:{type:e.Obj},postalcode:{type:e.String},deliveryaddress:{type:e.Obj},website:{type:e.String},basepriceid:{type:e.String},currencyid:{type:e.String},primarygroupid:{type:e.String},privateaccount:{type:e.String},salespersonid:{type:e.String,default:1},secondarygroupid:{type:e.String},stopcredit:{type:e.String},allowrestrictedstock:{type:e.String},credittermid:{type:e.String},needorderno:{type:e.Boolean,default:!1},active:{type:e.Boolean,default:!0},alphacode:{type:e.String},alert:{type:e.String},creditlimit:{type:e.Float},credittermwarningtext:{type:e.String},headaccno:{type:e.Integer},companytype:{type:e.Integer},extrafields:{type:e.Arr,default:[]},lastupdated:{type:e.String},balance:{type:e.Float},defaultcontactid:{type:e.Integer}});return i.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/debtor/].")},i},Et=function(t){const e=t.constructor;if(t.isDefined("stock"))return t.entity("stock");const i=t.define("stock",{stockcode:{type:e.String,primaryKey:!0},description:{type:e.String},href:{type:e.String},rel:{type:e.String},isactive:{type:e.Boolean},notes:{type:e.String}});return i.prototype.save=async()=>{throw new Error("EXO API does not support edit the item [https://developer.myob.com/api/exo/endpoints/stock/].")},i.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/stock/].")},i},vt=function(t){const e=t.constructor;if(t.isDefined("stockitem"))return t.entity("stockitem");const i=t.define("stockitem",{id:{type:e.String,primaryKey:!0},title:{type:e.String},href:{type:e.String},rel:{type:e.String},notes:{type:e.String},active:{type:e.Boolean,default:!0},extrafields:{type:e.Arr,default:[]},saleprices:{type:e.Arr,default:[]},description:{type:e.String},stocktype:{type:e.String},averagecost:{type:e.Float},standardcost:{type:e.Float},suppliercost:{type:e.Float},latestcost:{type:e.Float},webimagefilename:{type:e.String},webdescription:{type:e.String},showonweb:{type:e.Boolean},barcode1:{type:e.String},barcode2:{type:e.String},barcode3:{type:e.String},totalinstock:{type:e.Float},restricted:{type:e.Boolean},expireindays:{type:e.Integer},canexpire:{type:e.Boolean},discountable:{type:e.Boolean},batchnumberstracked:{type:e.Boolean},serialnumberstrackingtypename:{type:e.String},serialnumberstrackingtypeid:{type:e.Integer},serialnumberstracked:{type:e.Boolean},salestaxrate:{type:e.Obj},salestaxrateid:{type:e.Integer},unitofmeasure:{type:e.Obj},unitofmeasureid:{type:e.String},suppliercreditoraccountname:{type:e.String},suppliercreditoraccountid:{type:e.String},stockclassification:{type:e.Obj},stockclassificationid:{type:e.Integer},stockpricegroup:{type:e.Obj},stockpricegroupid:{type:e.Integer},secondarygroup:{type:e.Obj},secondarygroupid:{type:e.Integer},primarygroup:{type:e.Obj},primarygroupid:{type:e.Integer}});return i.prototype.save=async()=>{throw new Error("EXO API does not support edit the item [https://developer.myob.com/api/exo/endpoints/stock_item/].")},i.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/stock_item/].")},i},_t=function(t){const e=t.constructor,i="stockprimarygroup";if(t.isDefined(i))return t.entity(i);const r=t.define(i,{id:{type:e.Integer,primaryKey:!0},name:{type:e.String},href:{type:e.String},rel:{type:e.String},active:{type:e.Boolean}});return r.prototype.save=async()=>{throw new Error("EXO API does not support edit the item [https://developer.myob.com/api/exo/endpoints/"+i+"/].")},r.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/"+i+"/].")},r},xt=function(t){const e=t.constructor,i="stocksecondarygroup";if(t.isDefined(i))return t.entity(i);const r=t.define(i,{id:{type:e.Integer,primaryKey:!0},name:{type:e.String},href:{type:e.String},rel:{type:e.String},active:{type:e.Boolean}});return r.prototype.save=async()=>{throw new Error("EXO API does not support edit the item [https://developer.myob.com/api/exo/endpoints/"+i+"/].")},r.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/"+i+"/].")},r},Ot=function(t){const e=t.constructor;if(t.isDefined("salesorder"))return t.entity("salesorder");const i=t.define("salesorder",{id:{type:e.Integer,primaryKey:!0},title:{type:e.String},href:{type:e.String},rel:{type:e.String},debtorid:{type:e.Integer},lines:{type:e.Arr},taxrounding:{type:e.Float},deliverycount:{type:e.Integer},invoicecount:{type:e.Integer},pickedcount:{type:e.Integer},releasecount:{type:e.Integer},hasuninvoiced:{type:e.Boolean},hasunpicked:{type:e.Boolean},hasunreleased:{type:e.Boolean},hasunsupplied:{type:e.Boolean},allowcustomerordernumber:{type:e.Boolean},customerordernumber:{type:e.String},accountname:{type:e.String},istaxinclusive:{type:e.Boolean},hasbackorders:{type:e.Boolean},branchid:{type:e.Integer},branch:{type:e.Obj},defaultlocationid:{type:e.Integer},defaultlocation:{type:e.Obj},narrative:{type:e.String},currencyid:{type:e.Integer},currency:{type:e.Obj},contactid:{type:e.Integer},contact:{type:e.Obj},salespersonid:{type:e.Integer,default:[]},salesperson:{type:e.Obj},exchangerate:{type:e.Integer},taxtotal:{type:e.Integer},subtotal:{type:e.Integer},reference:{type:e.String},instructions:{type:e.String},createdate:{type:e.String},orderdate:{type:e.String},duedate:{type:e.String},finalisationdate:{type:e.String},activationdate:{type:e.String},deliveryaddress:{type:e.Obj},status:{type:e.Integer},statusdescription:{type:e.String},finalised:{type:e.Integer},ordertotal:{type:e.Integer},localvalue:{type:e.Integer},lock:{type:e.Obj},hasrestrictedline:{type:e.Boolean},lastupdated:{type:e.Arr},extrafields:{type:e.Arr}});return i.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/debtor/].")},i},It=function(t){const e=t.constructor;if(t.isDefined("staff"))return t.entity("staff");const i=t.define("staff",{id:{type:e.String,primaryKey:!0},title:{type:e.String},href:{type:e.String},rel:{type:e.String},name:{type:e.String},jobtitle:{type:e.String}});return i.prototype.save=async()=>{throw new Error("EXO API does not support edit the item [https://developer.myob.com/api/exo/endpoints/staff/].")},i.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/staff/].")},i},St=function(t){const e=t.constructor;if(t.isDefined("branch"))return t.entity("branch");const i=t.define("branch",{id:{type:e.String,primaryKey:!0},title:{type:e.String},href:{type:e.String},rel:{type:e.String},name:{type:e.String},code:{type:e.String}});return i.prototype.save=async()=>{throw new Error("EXO API does not support edit the item [https://developer.myob.com/api/exo/endpoints/branch/].")},i.prototype.delete=async()=>{throw new Error("EXO API does not support delete the item [https://developer.myob.com/api/exo/endpoints/branch/].")},i},kt=function(t){t.constructor;[{Debtor:At,StockItem:vt,SalesOrder:Ot,Staff:It,Branch:St,Stock:Et,StockPrimaryGroup:_t,StockSecondaryGroup:xt}].map(e=>{for(let i in e)t.hasOwnProperty(i)?t.hasOwnProperty("_"+i)||(t["_"+i]=e[i](t)):t[i]=e[i](t)})};console.log;class jt{constructor(t){const e=(t=t||{}).url||"http://localhost:8888/";this.rootUrl=e,this.cache={};const i={rootUrl:e};jt.runHooks("beforeInit",i,t),this.options=Object.assign({hooks:{},define:{}},t),this._setupHooks(t.hooks),this.config=i,this.entities={},this.entityManager=new et.a(this),this.connectionManager=new wt(this),kt(this),jt.runHooks("afterInit",this)}get CompanyInfo(){return this.companyInfo()}async companyInfo(){let t=await this.getEntityData("companydatafileinfo");return t&&t.value&&Array.isArray(t.value)?t.value[0]:null}get Staff1(){return this.staff1()}async staff1(){return await this.getEntityData("staff")}define(t,e,i={}){i.entityName=t,i.exo=this;const r=class extends Z{};return r.init(e,i),r}entity(t){if(!this.isDefined(t))throw new Error(`${t} has not been defined`);return this.entityManager.getEntity(t)}isDefined(t){return!!this.entityManager.entities.find(e=>e.name===t)}normalizeDataType(t){return"function"==typeof t?new t:t}normalizeAttribute(t){return a.a.isPlainObject(t)||(t={type:t}),t.type?(t.type=this.normalizeDataType(t.type),t.hasOwnProperty("defaultValue")&&"function"==typeof t.defaultValue&&(t.defaultValue=new t.defaultValue),t):t}getQueryInterface(){return this.odataInterface=this.odataInterface||new wt(this),this.odataInterface}async sql(t){const e=await this.executeSql(t);return 0===Object.keys(e).length&&e.constructor===Object?null:e}async sqlRow(t,e){e||(e=0);const i=await this.sql(t);return Array.isArray(i)&&i.length>e?i[e]:null}async sqlOne(t,e){const i=await this.sqlRow(t);return i?(e||(e=Object.keys(i)[0]),i[e]):null}async executeSql(t){const e=this.connectionManager.getConnection();return await this.runHooks("beforeQuery",{}),await e.executeSql(t)}async getEntityData(t,e=!0){const i=this.connectionManager.getConnection();return await i.getEntityData(t,e)}async postDataToExo(t,e){const i=this.connectionManager.getConnection();return await i.postDataToExo(t,e)}async getEntityXML(t,e=!0){const i=this.connectionManager.getConnection();return await i.getEntityXML(t,e)}async query(t,e){if((e=Object.assign({},this.options.query,e)).instance&&!e.entity&&(e.entity=e.instance.constructor),e.instance||e.entity||(e.raw=!0),e.mapToEntity&&(e.fieldMap=a.a.get(e,"entity.fieldAttributeMap",{})),(e=a.a.defaults(e,{logging:this.options.hasOwnProperty("logging")?this.options.logging:console.log,searchPath:this.options.hasOwnProperty("searchPath")?this.options.searchPath:"DEFAULT"})).type||(e.entity||e.nest||e.plain?e.type=s.a.SELECT:e.type=s.a.RAW),"object"==typeof t){if(void 0!==t.values){if(void 0!==e.replacements)throw new Error("Both `sql.values` and `options.replacements` cannot be set at the same time");e.replacements=t.values}if(void 0!==t.bind){if(void 0!==e.bind)throw new Error("Both `sql.bind` and `options.bind` cannot be set at the same time");e.bind=t.bind}void 0!==t.query&&(t=t.query)}if(t=t.trim(),e.sql=t,e.transaction&&e.transaction.finished){const i=new Error(`${e.transaction.finished} has been called on this transaction(${e.transaction.id}), you can no longer use it. (The rejected query is attached as the 'sql' property of this error)`);throw i.sql=t,i}const i=await e.transaction?e.transaction.connection:this.connectionManager.getConnection(e);if(await this.runHooks("beforeQuery",e),i instanceof wt.Handler){return await i.run(e)}throw new Error("Not implemented in exo.query()")}async insert(t,e,i){(i=Object.assign({},this.options.query,i)).instance&&!i.entity&&(i.entity=i.instance.construc
